<div>
    <%= render "shared/navbar" %>
    <!-- Main layout -->
    <div class="main-container">
        <!-- Sidebar -->
        <%= render "shared/sidebar" %>

        <!-- Profile section -->
        <div class="profile-container">
            <% if current_user == user %>
                <h3 style="text-align: center;">My Profile</h3>
                <p style="text-align: center;">Manage your personal information and account settings</p>
            <% else %>
                <h2 class="other-user-profile-title"><%= user.first_name %> <%= user.last_name %>'s profile</h2>
            <% end %>

            <div class="profile-card">
                <div class="card-header">
                    <h3>Personal Information</h3>
                    <% if current_user == user %>
                        <%= link_to "Edit Profile", edit_user_path(user), class: "edit-btn", title: "Edit Profile" %>
                    <% end %>
                </div>

                <div class="profile-body">
                    <div class="profile-left" style="text-align: center;">
                        <%# Show existing profile picture or placeholder %>
                        <% if user.profile_picture.attached? %>
                            <%= image_tag url_for(user.profile_picture), style: "border-radius: 50%; width: 100px; height: 100px; object-fit: cover;" %>
                        <% else %>
                            <i class="bi bi-person-circle" style="font-size: 100px; color: gray;"></i>
                        <% end %>
                        <p><%= "#{current_user.first_name} #{current_user.last_name}" %></p>
                        <% if current_user == user %>
                            <%= form_with model: user, url: upload_photo_user_path(user), method: :patch, local: true, html: { multipart: true, id: "upload-photo-form" } do |f| %>
                                <div style="margin-top: 10px; text-align: center;">
                                    <label for="profile_upload" class="change-photo-btn">
                                    Choose New Photo
                                    </label>

                                    <%= f.file_field :profile_picture, id: "profile_upload", style: "opacity: 0; position: absolute; left: -9999px;" %>

                                    <div id="upload-btn-wrapper" style="margin-top: 10px; display: none;">
                                    <%= f.submit "Upload", class: "upload-photo-btn" %>
                                    </div>
                                </div>
                            <% end %>
                        <% end %>
                    </div>

                    <div class="profile-content">
                        <div><strong>First Name: </strong> <%= user.first_name %></div>
                        <div><strong>Last Name: </strong> <%= user.last_name %></div>
                        <div><strong>Email Address: </strong> <%= user.email %></div>
                        <div><strong>Phone Number: </strong> <%= user.phone_number %></div>
                    </div>
                </div>
            </div>

            <div class="profile-card security-card">
                <div class="card-header">
                    <h3>Security</h3>
                </div> 
                <p class="security-description">
                    Keep your account secure by updating your password regularly. Make sure your new password is strong and unique.
                </p>
                <div class="card-header">
                    <div></div>
                    <% if current_user == user %>
                        <%= link_to "Change Password", edit_user_path(user), class: "edit-btn", title: "Change Password" %>
                    <% end %>
                </div>
            </div>
        </div>

        <!-- Right section -->
        <div class="summary-section">
            <div class="summary-card">
                <h3>Account Summary</h3>
                <div>
                    <label>Member Since</label>
                    <p><%= current_user.created_at.strftime("%B %d, %Y") %></p>
                </div>
                <div>
                    <label>Next Billing Date</label>
                    <p>June 15, 2023</p>
                </div>
            </div>
            <div class="summary-card">
                <h3>Overall Balance</h3>
                <div>
                    <label>You are owed</label>
                    <p>$<%= '%.2f' % (@you_are_owed || 0.0) %></p>
                </div>
                <div>
                    <label>You own</label>
                    <p>$<%= '%.2f' % (@you_owe || 0.0)  %></p>
                </div>
            </div>
            <div class="summary-card">
                <div>
                    <h3>Net Balance</h3>
                    <p>
                        <%= (@net_balance || 0.0) >= 0 ? "+$#{'%.2f' % (@net_balance || 0.0)}" : "-$#{'%.2f' % (@net_balance || 0.0).abs}" %>
                    </p>
                </div>
                <%= link_to "View Details", user_balances_path(current_user), class: "view-details-btn" %>
            </div>
            
        </div>
    </div>
</div>

<style>
/* Reset and Base Styles */
body, html {
    margin: 0;
    padding: 0;
    height: 100%;
    font-family: Arial, sans-serif;
    background-color: #f3f3f3;
}

/* Main Layout */
.main-container {
    display: flex;
    gap: 20px;
    padding: 20px;
    padding-top: 80px;
    box-sizing: border-box;
}

.logout-btn {
  background: white;
  color: #1d917a;
  border: none;
  padding: 6px 12px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
  text-decoration: none;
  display: inline-flex;
  align-items: center;
}

.logout-btn:hover {
  background-color: #0ca694;
  color: white;
}

/* Profile Container */
.profile-container {
    flex: 2;
}
.profile-container h3 {
    margin-top: 0;
}
.profile-card {
    background: white;
    padding: 20px;
    margin-top: 15px;
    border-radius: 8px;
    box-sizing: border-box;
}
.card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.edit-btn {
    background-color: #1d917a;
    color: white;
    border: none;
    padding: 6px 12px;
    border-radius: 4px;
    cursor: pointer;
    text-decoration: none; 
    display: inline-block;
    font-size: 14px;
}
.edit-btn:hover {
    background-color: #0ca694;
}

.other-user-profile-title {
    text-align: center;
    font-weight: bold;
}

/* Profile Body */
.profile-body {
    display: flex;
    gap: 40px;
    margin-top: 15px;
    align-items: center;
}
.profile-left {
    text-align: center;
}
.profile-left p {
    margin-top: 10px;
    font-weight: bold;
}
.profile-content div {
    margin-bottom: 10px;
    font-size: 14px;
}

/* Change Photo Button */
.change-photo-btn,
.upload-photo-btn {
    background: #1d917a;
    color: white;
    border: none;
    padding: 5px 10px;
    margin-top: 10px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
}
.change-photo-btn:hover,
.upload-photo-btn:hover {
    background-color: #0ca694;
}

/* Security Card */
.profile-card .profile-content {
    margin-top: 10px;
    font-size: 14px;
}

/* Summary Section */
.summary-section {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 15px;
}
.summary-card {
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-sizing: border-box;
}
.view-details-btn {
    background-color: #1d917a;
    color: white;
    border: none;
    padding: 8px 12px;
    border-radius: 4px;
    cursor: pointer;
    margin-top: 10px;
    text-decoration: none;
    font-size: 14px;
}
.view-details-btn:hover {
    background-color: #0ca694;
}

.security-description {
    margin-top: 10px;
    font-size: 14px;
    color: #555;
    line-height: 1.4;
}

/* Responsive Layout */
@media (max-width: 768px) {
    .main-container {
        flex-direction: column;
    }
    .profile-container, .summary-section {
        width: 100%;
    }
    .profile-container h3 {
        text-align: center;
    }
    .profile-body {
        flex-direction: column;
        align-items: center;
        gap: 20px;
    }
    .summary-section p {
        font-size: 14px;
    }
    h3 {
        font-size: 16px;
    }
    .other-user-profile-title {
        font-size: 18px;
    }
}

/* Small screens */
@media (max-width: 600px) {
    .profile-info {
        gap: 4px;
    }
    .profile-body {
        gap: 15px;
    }
    .profile-left p {
        font-size: 14px;
    }
    .profile-content div {
        font-size: 13px;
    }
}
</style>

<script>
  document.addEventListener("turbo:load", function () {
    const fileInput = document.getElementById("profile_upload");
    const uploadBtnWrapper = document.getElementById("upload-btn-wrapper");
    const form = document.getElementById("upload-photo-form");

    if (!fileInput || !uploadBtnWrapper || !form) return;

    fileInput.addEventListener("click", function () {
        this.value = null;
    })

    // Show Upload button when a file is selected
    fileInput.addEventListener("change", function () {
      if (fileInput.files.length > 0) {
        uploadBtnWrapper.style.display = "block";
      } else {
        uploadBtnWrapper.style.display = "none";
      }
    });

    // Reset button after form submission
    form.addEventListener("submit", function () {
      // Optional delay to allow the form to post first
      setTimeout(() => {
        fileInput.value = "";
        uploadBtnWrapper.style.display = "none";
      }, 100);
    });
  });
</script>



